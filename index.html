<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EXWIFE Presale</title>
  <style>
    .banner {
  position: relative;
  height: 300px;
  border-radius: 16px;
  border: 1px solid #ddd;
  overflow: hidden;
  background: url('img/exwife-hero.png') center/cover no-repeat;
  margin-bottom: 20px;
}
.banner::after {
  content: "";
  position: absolute; inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(250,250,250,0.85) 70%, #fafafa 100%);
}
.progress { height: 12px; background:#eee; border-radius: 999px; overflow:hidden; border:1px solid #ddd; }
    .progress > div { height: 100%; width: 0%; background:#111; }
    .kpi { display:flex; gap:16px; flex-wrap:wrap; font-size:14px; }
    .kpi b { font-weight:700; }
    body { font-family: ui-sans-serif, system-ui; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 18px; margin: 14px 0; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #333; background: #fff; cursor: pointer; }
    input { padding: 10px; border-radius: 8px; border: 1px solid #ccc; width: 120px; }
    .muted { color:#666; font-size: 13px; }
    .row { display:flex; gap:10px; align-items:center; }
    code { word-break: break-all; }
  .banner {
  position: relative;
  height: 380px;
  border-radius: 16px;
  border: 1px solid #e5e7eb;
  overflow: hidden;
  background: url('img/exwife-hero.png') center/cover no-repeat;
}
.banner::after {
  content: "";
  position: absolute; inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(250,250,250,0.85) 70%, #fafafa 100%);
}
.float-on-hero { margin-top: -90px; }
.card.lift { box-shadow: 0 10px 30px rgba(0,0,0,0.10); }

</style>
</head>
<body>
  <h1>Ex-Wife Token (EXWIFE)</h1>
<div class="banner" role="img" aria-label="EXWIFE hero banner"></div>
    <div class="card">
    <div id="status" class="muted">Not connected</div>
    <div class="row" style="margin-top:10px">
      <button id="connect">Connect Wallet</button>
      <button id="refresh">Refresh</button>
    </div>
  </div>

  <div class="card">
    <h3>Buy EXWIFE</h3>
    <div class="card">
  <h3>Progress</h3>
  <div class="kpi" style="margin:6px 0 10px">
    <div>Raised: <b><span id="raisedEth">0</span> ETH</b></div>
    <div>Goal: <b><span id="goalEth">0</span> ETH</b></div>
    <div>Status: <b><span id="saleStatus">Loading…</span></b></div>
  </div>
  <div class="progress"><div id="progressFill"></div></div>
  <div class="muted" style="margin-top:8px" id="progressMsg"></div>
</div>
<div class="muted">Send Sepolia ETH to the presale contract to mint tokens.</div>
    <div class="row" style="margin-top:10px">
      <input id="ethAmount" type="number" min="0.01" step="0.01" value="0.02">
      <button id="buy">Send ETH</button>
    </div>
    <div id="buyMsg" class="muted" style="margin-top:8px"></div>
  </div>

  <div class="card">
    <h3>Your Balances</h3>
    <div>ETH: <span id="ethBal">-</span></div>
    <div>EXWIFE: <span id="tokBal">-</span></div>
  </div>

  <div class="card">
    <h3>Contract Addresses</h3>
    <div>
      Token: <code id="tokenAddr"></code>
      — <a target="_blank" href="https://sepolia.etherscan.io/token/0x56b93E10aF78806ACF23Ff2CeD509F6a01aD615E">Etherscan</a>
    </div>
    <div>
      Presale: <code id="presaleAddr"></code>
      — <a target="_blank" href="https://sepolia.etherscan.io/address/0xbc37B0CC79a807590f2b68742Fa7333708C9D292">Etherscan</a>
    </div>
    <div class="muted">Network: Sepolia</div>
  </div>

  <!-- Ethers v6 via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>
  <script>
    // ✅ Hard-coded addresses (yours)
    const TOKEN_ADDRESS = "0x56b93E10aF78806ACF23Ff2CeD509F6a01aD615E";
    const PRESALE_ADDRESS = "0xbc37B0CC79a807590f2b68742Fa7333708C9D292";
// Progress goal (change this to whatever you want the target to be)
const GOAL_ETH = 1.0; // example goal: 1 ETH

    // Minimal ABIs
    const ERC20_ABI = [
      "function balanceOf(address) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function symbol() view returns (string)"
    ];
    const PRESALE_ABI = [
      "function openingTime() view returns (uint64)",
      "function closingTime() view returns (uint64)",
      "function minBuyWei() view returns (uint256)",
      "function finalized() view returns (bool)"
    ];

    let provider, signer, acct;
    const $ = (id) => document.getElementById(id);
    const fmt = (v, d=18) => ethers.formatUnits(v, d);

    async function connect() {
      if (!window.ethereum) { alert("Install MetaMask"); return; }
      await window.ethereum.request({ method: "eth_requestAccounts" });
      provider = new ethers.BrowserProvider(window.ethereum);
      signer = await provider.getSigner();
      acct = await signer.getAddress();
      $('status').textContent = "Connected: " + acct;
      await refresh();
    }

    async function refresh() {
      try {
        if (!provider && window.ethereum) provider = new ethers.BrowserProvider(window.ethereum);
        const network = provider ? await provider.getNetwork() : { name: "(no provider)" };
        $('status').textContent = "Connected to " + (network.name || "(unknown)") + " as " + (acct || "(not connected)");

        // ETH balance
        if (provider && acct) {
          const ethBal = await provider.getBalance(acct);
          $('ethBal').textContent = fmt(ethBal, 18);
        }

        // Token balance
        const tk = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, provider || ethers.getDefaultProvider());
        if (acct) {
          const d = await tk.decimals();
          const bal = await tk.balanceOf(acct);
          $('tokBal').textContent = fmt(bal, d);
        }

        // Presale info and UI lock
        const ps = new ethers.Contract(PRESALE_ADDRESS, PRESALE_ABI, provider || ethers.getDefaultProvider());
        const [open, close, minWei, fin] = await Promise.all([
          ps.openingTime(), ps.closingTime(), ps.minBuyWei(), ps.finalized()
        ]);

        const openStr = new Date(Number(open)*1000).toLocaleString();
        const closeStr = new Date(Number(close)*1000).toLocaleString();

        const buyBtn = $('buy');
        const amt = $('ethAmount');

        if (fin) {
          buyBtn.disabled = true;
          amt.disabled = true;
          $('buyMsg').textContent = `Sale window: ${openStr} → ${closeStr} | Finalized: ${fin} | Presale is closed.`;
        } else {
          buyBtn.disabled = false;
          amt.disabled = false;
          $('buyMsg').textContent = `Sale window: ${openStr} → ${closeStr} | Min buy: ${fmt(minWei, 18)} ETH | Finalized: ${fin}`;
        }
      } catch (e) {
        $('buyMsg').textContent = "Refresh failed: " + (e && e.message ? e.message : e);
      }// ----- Progress (Raised / Goal) -----
// Raised = current contract balance (note: after finalize(true), this will be 0 because funds are forwarded)
// During a live sale, this shows in-progress raised amount.
let raisedWei = 0n;
try {
  if (provider) {
    raisedWei = await provider.getBalance(PRESALE_ADDRESS);
  } else {
    // fallback: no injected provider — use default public provider for read
    raisedWei = await (ethers.getDefaultProvider()).getBalance(PRESALE_ADDRESS);
  }
} catch (e) {
  // ignore; leave as 0
}

const raisedEth = Number(ethers.formatEther(raisedWei));
const goalEth = Number(GOAL_ETH);
const pct = Math.max(0, Math.min(100, goalEth > 0 ? (raisedEth / goalEth) * 100 : 0));

// Update UI numbers
document.getElementById("raisedEth").textContent = raisedEth.toFixed(4);
document.getElementById("goalEth").textContent   = goalEth.toString();

// Fill bar
const fill = document.getElementById("progressFill");
fill.style.width = (fin ? "100%" : pct.toFixed(2) + "%");

// Status text
const saleStatus = document.getElementById("saleStatus");
saleStatus.textContent = fin ? "Finalized" : (pct >= 100 ? "Goal reached" : "Live");

// Helper message
const pm = document.getElementById("progressMsg");
if (fin) {
  pm.textContent = "Presale finalized — funds have likely been forwarded to treasury, so contract balance may read 0.";
} else if (pct >= 100) {
  pm.textContent = "Goal reached. Buys may still be accepted until closing time unless capped.";
} else {
  pm.textContent = `Progress: ${pct.toFixed(2)}%`;
}

    }

    async function buy() {
      try {
        if (!signer) await connect();
        const amt = $('ethAmount').value;
        if (!amt || Number(amt) <= 0) throw new Error("Enter amount > 0");
        const tx = await signer.sendTransaction({
          to: PRESALE_ADDRESS,
          value: ethers.parseEther(String(amt))
        });
        $('buyMsg').textContent = "Sending... " + tx.hash;
        await tx.wait();
        $('buyMsg').textContent = "Success! Tx: " + tx.hash;
        await refresh();
      } catch (e) {
        $('buyMsg').textContent = "Buy failed: " + (e && e.message ? e.message : e);
      }
    }

    $('tokenAddr').textContent = TOKEN_ADDRESS;
    $('presaleAddr').textContent = PRESALE_ADDRESS;
    $('connect').onclick = connect;
    $('refresh').onclick = refresh;
    $('buy').onclick = buy;
  </script>
</body>
</html>

